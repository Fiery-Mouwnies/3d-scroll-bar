/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/
import * as THREE from 'three'
import React, { useMemo, useContext, createContext, forwardRef } from 'react'
import { GroupProps } from '@react-three/fiber';
import { useGLTF, Merged } from '@react-three/drei'
import { GLTF } from 'three-stdlib'

// Type definitions (as provided by you)
type GLTFResult = GLTF & {
  nodes: { [key: string]: THREE.Mesh }
  materials: { [key: string]: THREE.MeshStandardMaterial }
}

const context = createContext(null)

// Instances component for performance - no changes needed here.
export function Instances({ children, ...props }) {
  const { nodes } = useGLTF('/energy_bar_v2.glb') as GLTFResult
  const instances = useMemo(
    () => {
        const result = {}
        // Dynamically create the instances map from all nodes
        for (const nodeName in nodes) {
            if(nodes[nodeName].isMesh) {
                result[nodes[nodeName].name] = nodes[nodeName]
            }
        }
        return result
    },
    [nodes],
  )
  return (
    <Merged meshes={instances} {...props}>
      {(instances) => <context.Provider value={instances} children={children} />}
    </Merged>
  )
}

// **MAIN FIX AREA**
// 1. Renamed 'Model' to 'Energybar' and wrapped in forwardRef.
export const Energybar = forwardRef<THREE.Group, GroupProps>((props, ref) => {
  const instances = useContext(context)
  return (
    // 2. Attached the ref to the main group.
    <group {...props} dispose={null} ref={ref}>
      <group name="Sketchfab_Scene">
        <group name="Sketchfab_model" rotation={[-Math.PI / 2, 0, 0]}>
          <group name="2e7513e960664aedaff860fe2491e0b6fbx" rotation={[Math.PI / 2, 0, 0]}>
            <group name="RootNode">
              <group name="group5">
                <group name="group4" rotation={[-0.048, 0.025, 0.139]}>
                  {/* 3. REMOVED the hardcoded scale from this inner group */}
                  <group name="pCube3">
                    <instances.pCube3_aiStandardSurface1_0 />
                  </group>
                  <group name="group2">
                    {/* All the other groups generated by the tool should be here */}
                    {/* The following are just examples */}
                    <group name="pCube6" position={[-11.263, 4.109, -0.001]} rotation={[-1.574, 0.075, -0.003]} scale={[0.536, 0.022, 0.034]}><instances.pCube6_aiStandardSurface2_0/></group>
                    <group name="pCube329" position={[11.795, 3.532, -0.001]} rotation={[-1.566, 0.058, 0]} scale={[0.71, 0.014, 0.034]}><instances.pCube329_aiStandardSurface3_0/></group>
                    {/* Paste the rest of your inner groups from your original file here */}
                  </group>
                </group>
              </group>
            </group>
          </group>
        </group>
      </group>
    </group>
  )
})

useGLTF.preload('/energy_bar_v2.glb')