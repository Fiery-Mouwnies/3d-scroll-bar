/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import * as THREE from 'three';
import React, { useMemo, useContext, createContext, forwardRef } from 'react';
import { useGLTF, Merged } from '@react-three/drei';
import { GLTF } from 'three-stdlib';
import { GroupProps } from '@react-three/fiber';

// Type definitions from the converter
type GLTFResult = GLTF & {
  nodes: { [key: string]: THREE.Mesh };
  materials: { [key: string]: THREE.MeshStandardMaterial };
};

const context = createContext(null);

// Instances component for performance
export function Instances({ children, ...props }) {
  const { nodes } = useGLTF('/energy_bar_v2.glb') as GLTFResult;
  const instances = useMemo(() => {
    const inst: { [key: string]: THREE.Mesh } = {};
    Object.values(nodes).forEach(node => {
        if (node.isMesh) {
           inst[node.name] = node;
        }
    });
    return inst;
  }, [nodes]);

  return (
    <Merged meshes={instances} {...props}>
      {(instancesVal) => <context.Provider value={instancesVal} children={children} />}
    </Merged>
  );
}

// ** THE FIX IS HERE **
// Renamed 'Model' to 'Energybar' and wrapped in forwardRef
export const Energybar = forwardRef<THREE.Group, GroupProps>((props, ref) => {
  const instances = useContext(context);
  
  return (
    // The ref is attached to this top-level group
    <group {...props} dispose={null} ref={ref}>
      <group name="Sketchfab_Scene">
        <group name="Sketchfab_model" rotation={[-Math.PI / 2, 0, 0]}>
          <group name="2e7513e960664aedaff860fe2491e0b6fbx" rotation={[Math.PI / 2, 0, 0]}>
            <group name="RootNode">
              <group name="group5">
                <group name="group4" rotation={[-0.048, 0.025, 0.139]}>
                  {/* NOTE: We REMOVED the hardcoded scale from this inner group */}
                  <group name="pCube3">
                    <instances.pCube3_aiStandardSurface1_0 />
                  </group>
                  <group name="group2">
                    <group name="pCube6" position={[-11.263, 4.109, -0.001]} rotation={[-1.574, 0.075, -0.003]} scale={[0.536, 0.022, 0.034]}>
                      <instances.pCube6_aiStandardSurface2_0 />
                    </group>
                    {/* ... The converter pastes ALL other 300+ parts here ... */}
                    <group name="pCube329" position={[11.795, 3.532, -0.001]} rotation={[-1.566, 0.058, 0]} scale={[0.71, 0.014, 0.034]}>
                      <instances.pCube329_aiStandardSurface3_0 />
                    </group>
                  </group>
                </group>
              </group>
            </group>
          </group>
        </group>
      </group>
    </group>
  );
});

useGLTF.preload('/energy_bar_v2.glb');